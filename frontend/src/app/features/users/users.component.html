<section class="users animate-fade-in">
  <header>
    <div>
      <h1>
        <i class="fas fa-user-cog"></i> Users
      </h1>
      <p>Manage system users and permissions</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="openCreateForm()">
        <i class="fas fa-plus"></i> New User
      </button>
    </div>
  </header>

  <div class="content">
    <section class="list" *ngIf="!loading(); else loadingTpl">
      <div class="users-grid">
        <article
          *ngFor="let user of users(); let i = index"
          [style.animation-delay.ms]="i * 50"
          class="user-card animate-scale-in"
        >
          <div class="user-avatar">
            <i class="fas fa-user"></i>
          </div>
          <div class="user-info">
            <h3>{{ user.fullName }}</h3>
            <p class="username">
              <i class="fas fa-at"></i> {{ user.username }}
            </p>
            <p class="email">
              <i class="fas fa-envelope"></i> {{ user.email }}
            </p>
            <div class="user-meta">
              <span class="badge" [ngClass]="'role-' + user.role.toLowerCase()">
                {{ user.role }}
              </span>
              <span class="badge" [ngClass]="user.isActive ? 'active' : 'inactive'">
                {{ user.isActive ? 'Active' : 'Inactive' }}
              </span>
            </div>
            <p class="department" *ngIf="user.department">
              <i class="fas fa-building"></i> {{ user.department }}
            </p>
          </div>
          <div class="user-actions">
            <button class="btn btn-sm btn-secondary" (click)="openEditForm(user)">
              <i class="fas fa-edit"></i> Edit
            </button>
            <button 
              *ngIf="user.isActive" 
              class="btn btn-sm btn-danger" 
              (click)="deactivateUser(user.id)">
              <i class="fas fa-ban"></i> Deactivate
            </button>
          </div>
        </article>
      </div>
      <p *ngIf="!users().length" class="empty">No users found.</p>
    </section>
  </div>

  <!-- Create/Edit Form Modal -->
  <div *ngIf="showForm()" class="modal-overlay" (click)="showForm.set(false)">
    <div class="modal-content animate-scale-in" (click)="$event.stopPropagation()">
      <h2>{{ isEditing() ? 'Edit User' : 'Create New User' }}</h2>
      <form [formGroup]="userForm" (ngSubmit)="saveUser()">
        <div class="row">
          <div class="col-md-6">
            <label><i class="fas fa-user"></i> Username *</label>
            <input 
              formControlName="username" 
              class="form-control"
              [readonly]="isEditing()" />
          </div>
          <div class="col-md-6">
            <label><i class="fas fa-envelope"></i> Email *</label>
            <input 
              type="email"
              formControlName="email" 
              class="form-control"
              [readonly]="isEditing()" />
          </div>
        </div>
        <div class="form-group">
          <label><i class="fas fa-id-card"></i> Full Name *</label>
          <input formControlName="fullName" class="form-control" />
        </div>
        <div class="row">
          <div class="col-md-6">
            <label><i class="fas fa-user-tag"></i> Role *</label>
            <select formControlName="role" class="form-control">
              <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
            </select>
          </div>
          <div class="col-md-6">
            <label><i class="fas fa-building"></i> Department</label>
            <select formControlName="department" class="form-control">
              <option value="">-- Select Department --</option>
              <option *ngFor="let dept of departments" [value]="dept">{{ dept }}</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label><i class="fas fa-lock"></i> Password {{ isEditing() ? '(leave empty to keep current)' : '*' }}</label>
          <input 
            type="password"
            formControlName="password" 
            class="form-control"
            [required]="!isEditing()" />
        </div>
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="isActive" />
            <span><i class="fas fa-check-circle"></i> Active</span>
          </label>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="showForm.set(false)">Cancel</button>
          <button type="submit" class="btn btn-primary">Save</button>
        </div>
      </form>
    </div>
  </div>

  <ng-template #loadingTpl>
    <div class="loading">
      <div class="spinner"></div>
      Loading users...
    </div>
  </ng-template>
</section>
